[build]
  base = ""
  # Build command - ensure it runs Next.js build
  command = "rm -f yarn.lock && npm install --legacy-peer-deps && npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "20.19.0"
  NPM_FLAGS = "--legacy-peer-deps"
  # Try to force npm
  NETLIFY_USE_NPM = "true"
  # NEXTAUTH_URL must be set in Netlify UI (Site settings → Build & deploy → Environment)
  # Do not hardcode it here to avoid secrets scanning issues
  # Configure secrets scanning to ignore NEXTAUTH_URL (it's not a secret, just a URL)
  SECRETS_SCAN_OMIT_KEYS = "NEXTAUTH_URL"

[functions]
  node_bundler = "esbuild"
  included_files = ["prisma/**/*"]

